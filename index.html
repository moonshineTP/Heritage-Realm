<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dấu Di Sản: Miền Trung</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    
    <!-- External Libraries -->
    <!-- js-yaml for parsing flow.yaml without a build step -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Background Pattern (Theme 20%) -->
        <div id="bg-pattern"></div>

        <!-- Orientation Warning -->
        <div id="orientation-warning">
            <span style="font-size:3rem">&#8635;</span>
            <p>Vui lòng xoay màn hình vào chế độ dọc để tiếp tục trải nghiệm.</p>
        </div>

        <!-- 1. Loading Screen -->
        <div id="screen-loading" class="screen active">
            <div class="pulse-logo">
                <img id="ui-loading-logo" src="assets/icons/logo.svg" alt="Logo">
            </div>
            <p id="ui-loading-text" class="loading-text">Đang tải dữ liệu...</p>
            <div class="progress-bar"><div class="progress-fill"></div></div>
        </div>

        <!-- 2. Intro Screen with Curtain Effect -->
        <div id="screen-intro" class="screen">
            <!-- The landing content with its own beautiful background -->
            <div class="intro-landing" id="intro-landing">
                <div class="intro-content">
                    <h1 id="ui-intro-title" class="title"></h1>
                    <h2 id="ui-intro-subtitle" class="subtitle"></h2>
                    <p id="ui-intro-text" class="intro-text"></p>
                    <button id="btn-start" class="btn breathe-effect"></button>
                </div>
            </div>

            <!-- The split curtains (initially hidden/open, then close, then open) -->
            <div class="curtain curtain-left" id="curtain-left"></div>
            <div class="curtain curtain-right" id="curtain-right"></div>
        </div>

        <!-- 3. Story Screen (Zone 1 Structure) -->
        <div id="screen-story" class="screen">
            <!-- Top: Logo, Zone Name & Audio toggle -->
            <header class="story-header">
                <img id="ui-story-logo" src="assets/icons/logo.svg" alt="Logo" class="small-logo">
                <span class="zone-name" id="ui-zone-name"></span>
                <button id="btn-audio" class="btn-audio-toggle" title="Bật/Tắt âm thanh" aria-label="Toggle audio">
                    <svg class="icon-sound" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <path class="sound-wave-1" d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                        <path class="sound-wave-2" d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                    </svg>
                    <svg class="icon-mute" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <line x1="23" y1="9" x2="17" y2="15"/>
                        <line x1="17" y1="9" x2="23" y2="15"/>
                    </svg>
                </button>
            </header>

            <!-- Center: Image, Text -->
            <main class="story-center">
                <div class="parallax-container" id="slide-image-container">
                    <img src="" alt="" class="parallax-image" id="ui-slide-image">
                </div>
                <div class="story-info">
                    <p id="ui-slide-text" class="classic-text"></p>
                </div>
            </main>

            <!-- Bottom: Navigation -->
            <footer class="story-footer">
                <div class="nav-dots" id="ui-nav-dots"></div>
                <div class="swipe-hint">Vuốt hoặc bấm mũi tên để khám phá <span class="arrow">&rarr;</span></div>
            </footer>
        </div>

        <!-- 3.5 Challenge Screen (Trang chờ trước Quiz) -->
        <div id="screen-challenge" class="screen">
            <div class="challenge-landing" id="challenge-landing">
                <div class="challenge-content">
                    <h1 id="ui-challenge-title" class="title"></h1>
                    <p id="ui-challenge-desc" class="intro-text"></p>
                    <button id="btn-start-quiz" class="btn breathe-effect"></button>
                </div>
            </div>
        </div>

        <!-- 4. Quiz Screen (Overlay — Slide Up) -->
        <div id="screen-quiz" class="screen overlay-screen">
            <div class="quiz-container">
                <header class="quiz-header">
                    <button id="btn-close-quiz" class="btn-close" aria-label="Đóng">&times;</button>
                    <div class="quiz-progress">
                        <div class="progress-fill" id="ui-quiz-progress"></div>
                    </div>
                </header>
                <main class="quiz-main">
                    <h2 id="ui-quiz-question" class="question-text"></h2>
                    <div id="ui-quiz-options" class="options-container">
                        <!-- Options will be injected here -->
                    </div>
                </main>
            </div>
        </div>

        <!-- 5. End Screen -->
        <div id="screen-endscreen" class="screen end-screen">
            <!-- Polaroid photos pinned on sides -->
            <div class="polaroid-cluster">
                <div class="polaroid p-left" style="--rot:-8deg; --delay:1.2s">
                    <img src="assets/images/polaroid-01.png" alt="Hội An">
                    <span class="polaroid-label">Hội An</span>
                </div>
                <div class="polaroid p-right" style="--rot:6deg; --delay:1.5s">
                    <img src="assets/images/polaroid-02.png" alt="Đại Nội">
                    <span class="polaroid-label">Đại Nội</span>
                </div>
                <div class="polaroid p-left p-low" style="--rot:5deg; --delay:1.8s">
                    <img src="assets/images/polaroid-03.png" alt="Mỹ Sơn">
                    <span class="polaroid-label">Mỹ Sơn</span>
                </div>
            </div>

            <div class="end-container">
                <!-- Badge Assembly Area -->
                <div class="badge-stage">
                    <img class="wreath-bg" src="assets/icons/laurel-wreath.svg" alt="">
                    <div class="badge-half badge-left" id="badge-left"></div>
                    <div class="badge-half badge-right" id="badge-right"></div>
                    <div class="badge-full" id="badge-full"></div>
                    <div class="badge-glow" id="badge-glow"></div>
                </div>

                <!-- Score -->
                <div class="end-score" id="ui-end-score"></div>

                <!-- Congrats -->
                <h1 class="end-title" id="ui-end-title"></h1>
                <p class="end-message" id="ui-end-message"></p>

                <!-- Actions -->
                <div class="end-actions">
                    <button id="btn-share" class="btn btn-share breathe-effect">
                        <svg class="share-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
                        <span id="btn-share-text"></span>
                    </button>
                    <button id="btn-replay" class="btn-icon btn-replay"></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup Explanation — OUTSIDE #app so no parent transform clips it -->
    <div id="quiz-popup" class="quiz-popup">
        <div class="popup-content">
            <h3 id="ui-popup-title" class="popup-title"></h3>
            <p id="ui-popup-message" class="popup-message"></p>
            <p id="ui-popup-explanation" class="popup-explanation"></p>
        </div>
    </div>

    <!-- Application Logic -->
    <script src="js/config.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/share.js"></script>
    <script src="js/app.js"></script>
</body>
</html>